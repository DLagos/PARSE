<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>My Account</title>


    <!-- Stylesheets -->
    <% include templates/stylesheet-refs.ejs %>

    <!-- Google Analytics snippet -->
    <% include templates/google-analytics.ejs %>
</head>

<body>

    <header>
        <!--  BEGIN NAVIGATION BAR -->
        <% include templates/navigation.ejs %>
        <!-- END OF NAVIGATION BAR -->
    </header>

<!-- Main content -->
    <div class="container">

    <% if(locals.isAdmin){ %>
        <div class="row">

            <!-- The filter side of the dashboard page -->
            <div class="col-md-2" id="dashboard-filter">

                <div class="row">
                    <div class="col-md-12">
                        <h1>Filter by:</h1>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 filter-button" id="pending-filter-button">
                        <h2 class="filter-title">Pending</h2>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 filter-button" id="completed-filter-button">
                        <h2 class="filter-title">Completed</h2>
                    </div>
                </div>


            </div>


            <!-- The list of issues to update -->
            <div class="col-md-10" id="dashboard-issues-list">

                <h1 id="pending-issue-title">Pending Issues</h1>
                <h1 id="completed-issue-title">Completed Issues</h1>
                <% include templates/account_issues.ejs %>

            </div>


        </div>
        <%} else { %>
        <section class="jumbotron text-center">
        <div class="container">
            <h1>Welcome, </h1>
            <h1 class="jumbotron-heading">CSC 648 - Team 4</h1>
            <p class="lead text-muted">
                Environmental Reporting Tool<br>
                This website is the term project for CSC648/848's Team 04.
            </p>
        </div>
        </section>
        <% } %>

    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- Script references -->
    <% include templates/javascript-refs.ejs %>

    <script type="text/javascript">

        $(function() {

            // Filter code ---------------------------------------
            $(".completed").hide();
            $(".pending").show();
            $("#completed-issue-title").hide();


            $("#pending-filter-button").on("click", function(e) {
                $(".completed").hide();
                $(".pending").show();
                $("#completed-issue-title").hide();
                $("#pending-issue-title").show();
            });

            $("#completed-filter-button").on("click", function(e) {
                $(".completed").show();
                $(".pending").hide();
                $("#completed-issue-title").show();
                $("#pending-issue-title").hide();
            });


            // Submit code --------------------------------------------

            // Submit Listener for the "form"
            // This event will update the database with the new issue status.
            $(".issue-list-item").on("submit", function(e) {
                e.preventDefault(); // Prevent the page from refreshing

                // Ajax request will go here to update the database
                var data = $(this).serialize();
                data.title = "title";
                data.message = "message";
                $.ajax({
                    type: 'POST',
                    data: data,
                    dataType: 'application/json',
                    url: '/user/update_status',
                    success: function(data) {
                        console.log('success');
                        console.log(JSON.stringify(data));
                    }
                });

                var pending = "pending";
                var completed = "completed";

                var el = $(this).parent().parent();
                if (el.hasClass(pending)) {
                    el.removeClass(pending);
                    el.addClass(completed);
                    //el.find(".issue-button").html("Set to Complete");
                } else if (el.hasClass(completed)) {
                    el.removeClass(completed);
                    el.addClass(pending);
                    //el.find(".issue-button").html("Set to Pending");
                }
                el.hide();



                // Show the data so that we know it's working
                /*
                var alertMsg = "DEBUG MESSAGE\nSubmitted the following info:\n";
                alert(alertMsg + $(this).serialize());
                */


            });

            // It causes the form to submit
            $(".issue-button").on("click", function(e) {
                $(this).parent().submit(); // The parent form
            });

        });
    </script>

</body>
</html>
